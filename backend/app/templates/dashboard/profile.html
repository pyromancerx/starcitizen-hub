{% extends "base.html" %}

{% block title %}My Profile - {{ instance_name }}{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Page header -->
    <div>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">My Profile</h1>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            Manage your personal information and preferences.
        </p>
    </div>

    <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
        <form hx-put="/profile"
              hx-target="#profile-result"
              hx-swap="innerHTML"
              hx-headers='{"X-CSRF-TOKEN": "{{ csrf_token }}"}'
              class="divide-y divide-gray-200 dark:divide-gray-700">

            <div id="profile-result"></div>

            <!-- Profile details -->
            <div class="px-4 py-5 sm:p-6">
                <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                    <!-- Avatar section -->
                    <div class="sm:col-span-6 flex items-center space-x-6">
                        <div class="flex-shrink-0">
                            {% if current_user.avatar_url %}
                            <img class="h-16 w-16 rounded-full" src="{{ current_user.avatar_url }}" alt="{{ current_user.display_name }}">
                            {% else %}
                            <div class="h-16 w-16 rounded-full bg-sc-blue flex items-center justify-center text-white text-2xl font-bold">
                                {{ (current_user.display_name or current_user.email)[0].upper() }}
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="avatar_url" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                                Avatar URL
                            </label>
                            <div class="mt-1 flex rounded-md shadow-sm">
                                <input type="text" name="avatar_url" id="avatar_url" value="{{ current_user.avatar_url or '' }}"
                                       class="flex-1 min-w-0 block w-full px-3 py-2 rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-sc-blue focus:border-sc-blue sm:text-sm"
                                       placeholder="https://example.com/avatar.jpg">
                            </div>
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                                Enter a direct link to an image for your avatar.
                            </p>
                        </div>
                    </div>

                    <div class="sm:col-span-4">
                        <label for="email" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Email address
                        </label>
                        <input type="email" name="email" id="email" value="{{ current_user.email }}" disabled
                               class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 dark:bg-gray-600 dark:border-gray-500 text-gray-500 dark:text-gray-400 cursor-not-allowed shadow-sm focus:border-sc-blue focus:ring-sc-blue sm:text-sm">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                            Email cannot be changed. Contact an admin for assistance.
                        </p>
                    </div>

                    <div class="sm:col-span-3">
                        <label for="display_name" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            Display Name
                        </label>
                        <input type="text" name="display_name" id="display_name" value="{{ current_user.display_name or '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-sc-blue focus:ring-sc-blue sm:text-sm">
                    </div>

                    <div class="sm:col-span-3">
                        <label for="rsi_handle" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
                            RSI Handle
                        </label>
                        <input type="text" name="rsi_handle" id="rsi_handle" value="{{ current_user.rsi_handle or '' }}"
                               class="mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-sc-blue focus:ring-sc-blue sm:text-sm">
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                            Your in-game handle for verification.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Form actions -->
            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700/50 text-right sm:px-6">
                <button type="submit"
                        class="inline-flex justify-center rounded-md border border-transparent bg-sc-blue py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-sc-blue focus:ring-offset-2">
                    <span class="htmx-indicator mr-2">
                        <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </span>
                    Save Changes
                </button>
            </div>
        </form>
    </div>

    <!-- Account status -->
    <div class="bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:p-6">
            <h3 class="text-lg font-medium leading-6 text-gray-900 dark:text-white">Account Status</h3>
            <div class="mt-4 border-t border-gray-200 dark:border-gray-700 pt-4">
                <dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2">
                    <div class="sm:col-span-1">
                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Membership</dt>
                        <dd class="mt-1 text-sm text-gray-900 dark:text-white flex items-center">
                            {% if current_user.is_approved %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
                                Approved
                            </span>
                            {% else %}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200">
                                Pending Approval
                            </span>
                            {% endif %}
                        </dd>
                    </div>
                    <div class="sm:col-span-1">
                        <dt class="text-sm font-medium text-gray-500 dark:text-gray-400">Joined</dt>
                        <dd class="mt-1 text-sm text-gray-900 dark:text-white">
                            {{ current_user.created_at.strftime('%B %d, %Y') }}
                        </dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>
</div>
{% endblock %}